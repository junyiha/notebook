---
category: DeepLearning
date: 2025-05-15 09:00:00 +0800
layout: post
title: YOLOéƒ¨ç½²
tag: DL
---
## æ‘˜è¦

+ æ·±åº¦å­¦ä¹ æ¨¡å‹éƒ¨ç½² YOLOéƒ¨ç½²éƒ¨åˆ†ç›¸å…³å­¦ä¹ ç¬”è®°

<!--more-->

## YOLO åå¤„ç†è¾“å‡º1ï¼Œ5ï¼Œ8400

ä½ æåˆ° YOLO åå¤„ç†è¾“å‡ºçš„å½¢çŠ¶æ˜¯ï¼š

```
[1, 5, 8400]
```

è¿™æ˜¯ä¸€ä¸ª **ä¸æ ‡å‡† YOLOv8 ONNX è¾“å‡ºä¸åŒçš„ç»“æ„**ï¼Œä½†å®ƒåœ¨æŸäº›è½¬æ¢åœºæ™¯ä¸­ï¼ˆå¦‚æŸäº›ç‰ˆæœ¬çš„ ONNX å¯¼å‡ºã€TensorRT ä¼˜åŒ–æ¨¡å‹ï¼‰ç¡®å®å¯èƒ½å‡ºç°ã€‚è¿™ç§å½¢çŠ¶çš„å«ä¹‰å–å†³äºå…¶æ’åˆ—æ–¹å¼ã€‚

---

## ğŸ” è¾“å‡º `[1, 5, 8400]` çš„å«ä¹‰åˆ†æ

è¿™ç§å¼ é‡é€šå¸¸ä»£è¡¨ï¼š

* `1`: batch size
* `5`: æ¯ä¸ªé¢„æµ‹æ¡†çš„ç»´åº¦ï¼ˆå¯èƒ½æ˜¯ `[x, y, w, h, conf]`ï¼‰
* `8400`: å€™é€‰æ¡†æ•°é‡ï¼ˆç”±ç½‘ç»œè¾“å‡ºç‰¹å¾å›¾å¤§å°å†³å®šï¼‰

ä½† **é€šå¸¸è¿™ç±»å¼ é‡éœ€è¦è½¬ç½®** æˆæˆ‘ä»¬ç†Ÿæ‚‰çš„ `[8400, 5]` ç»“æ„ç”¨äºå¤„ç†ã€‚

---

## âœ… æ­£ç¡®è½¬æ¢æ–¹å¼

ä½ éœ€è¦å°†è¯¥å¼ é‡ä» `[1, 5, 8400]` è½¬æ¢ä¸º `[8400, 5]`ï¼š

```python
import numpy as np

# å‡è®¾ä½ ä» ONNX æ‹¿åˆ°çš„æ˜¯ output.shape = [1, 5, 8400]
output = output[0]             # shape: [5, 8400]
output = output.transpose(1, 0)  # shape: [8400, 5]
```

### å¦‚æœæ˜¯ `[1, 85, 8400]`ï¼Œä¹Ÿæ˜¯ç±»ä¼¼å¤„ç†ï¼š

```python
output = output[0].transpose(1, 0)  # [8400, 85]
```

---

## ğŸ“Œ åå¤„ç†é€šç”¨æµç¨‹ï¼ˆå¦‚æœä½ æœ‰ `[8400, 85]`ï¼‰

ä½ å¤„ç†è¿™ä¸ª `output` çš„åç»­é€»è¾‘æ˜¯ï¼š

```python
boxes = output[:, 0:4]       # x, y, w, h
objectness = output[:, 4]   # ç½®ä¿¡åº¦
class_scores = output[:, 5:]  # å„ç±»åˆ«åˆ†æ•°

class_conf = np.max(class_scores, axis=1)
class_id = np.argmax(class_scores, axis=1)
final_score = objectness * class_conf

# é˜ˆå€¼è¿‡æ»¤
mask = final_score > 0.25
boxes = boxes[mask]
final_score = final_score[mask]
class_id = class_id[mask]

# åæ ‡å˜æ¢ xywh â†’ xyxy
boxes[:, 0] = boxes[:, 0] - boxes[:, 2] / 2
boxes[:, 1] = boxes[:, 1] - boxes[:, 3] / 2
boxes[:, 2] = boxes[:, 0] + boxes[:, 2]
boxes[:, 3] = boxes[:, 1] + boxes[:, 3]
```

ç„¶åä½ å°±å¯ä»¥ä½¿ç”¨ `torchvision.ops.nms()` æˆ–å…¶ä»– NMS æ–¹æ³•è¿›è¡Œå»é‡äº†ã€‚

---

## ğŸš¨ å°ç»“

| åŸå§‹è¾“å‡º            | å«ä¹‰                  | å¤„ç†æ–¹å¼                          |
| --------------- | ------------------- | ----------------------------- |
| `[1, 5, 8400]`  | æ¯ä¸ªæ¡† 5 ä¸ªç»´åº¦ï¼Œå…± 8400 ä¸ªæ¡† | `.squeeze(0).transpose(1, 0)` |
| `[1, 85, 8400]` | æ¯ä¸ªæ¡†åŒ…å« class scores  | `.squeeze(0).transpose(1, 0)` |
| `[1, 8400, 85]` | å®˜æ–¹ YOLOv8 æ ¼å¼        | æ— éœ€è½¬ç½®                          |

---

å¦‚ä½ èƒ½æä¾›è¾“å‡ºç»´åº¦è¯¦æƒ…ï¼ˆä¾‹å¦‚ 5 æ˜¯å“ªäº›å†…å®¹ï¼Ÿæ˜¯å¦åŒ…å« classï¼Ÿï¼‰ï¼Œæˆ‘å¯ä»¥è¿›ä¸€æ­¥å¸®ä½ å†™å®Œæ•´çš„åå¤„ç†ä»£ç ï¼ˆæ”¯æŒ NMSã€è¾“å‡ºæœ€ç»ˆç»“æœç­‰ï¼‰ã€‚ä½ ä¹Ÿå¯ä»¥è´´ä¸€ä¸ªå°çš„å®é™…è¾“å‡ºç‰‡æ®µã€‚æ˜¯å¦ç»§ç»­æ·±å…¥è¿™éƒ¨åˆ†ï¼Ÿ

## [1, 5, 8400]ä¸­çš„1è¡¨ç¤ºä»€ä¹ˆ

åœ¨ä½ æåˆ°çš„ `[1, 5, 8400]` è¿™ä¸ªå¼ é‡ä¸­ï¼Œ**ç»´åº¦çš„å«ä¹‰æ˜¯**ï¼š

```
[batch_size, attributes, num_predictions]
```

### ğŸ“Œ å„ç»´åº¦å«ä¹‰è§£æï¼š

| ç»´åº¦ç´¢å¼• | å¤§å°   | å«ä¹‰                                     |
| ---- | ---- | -------------------------------------- |
| `0`  | 1    | **Batch size**ï¼Œè¡¨ç¤ºåªæœ‰ä¸€å¼ å›¾åƒè¾“å…¥              |
| `1`  | 5    | æ¯ä¸ªé¢„æµ‹æ¡†çš„å±æ€§æ•°é‡ï¼ˆå¦‚ `[x, y, w, h, obj_conf]`ï¼‰ |
| `2`  | 8400 | æ¯å¼ å›¾ç‰‡ä¸­é¢„æµ‹çš„æ¡†æ€»æ•°é‡ï¼ˆç”±ç½‘ç»œè¾“å‡ºå±‚å¤§å°å†³å®šï¼‰               |

---

### âœ… è¯¦ç»†è§£é‡Šï¼š

* **`1`ï¼ˆbatch sizeï¼‰**ï¼š
  è¡¨ç¤ºè¿™æ˜¯å¯¹ **1 å¼ å›¾åƒçš„é¢„æµ‹ç»“æœ**ã€‚å¦‚æœä¸€æ¬¡è¾“å…¥å¤šå¼ å›¾ï¼Œbatch size ä¼šå˜ä¸ºå¯¹åº”æ•°é‡ï¼Œä¾‹å¦‚ `[4, 5, 8400]` å°±ä»£è¡¨ 4 å¼ å›¾åƒã€‚

* **`5`ï¼ˆæ¯ä¸ªæ¡†çš„ç»´åº¦ï¼‰**ï¼š
  è¡¨ç¤ºæ¯ä¸ªé¢„æµ‹æ¡†åŒ…å« 5 ä¸ªå±æ€§ï¼Œå¸¸è§çš„æ˜¯ï¼š

  ```
  [x_center, y_center, width, height, objectness_confidence]
  ```

  ä¸åŒ…å«åˆ†ç±»åˆ†æ•°ï¼Œè¯´æ˜è¿™å¯èƒ½æ˜¯ YOLOv8 æˆ–å…¶ä»–æ¨¡å‹çš„ä¸­é—´è¾“å‡ºï¼Œ**è¿˜æ²¡åŒ…å« class scores**ã€‚

* **`8400`ï¼ˆé¢„æµ‹æ¡†æ•°é‡ï¼‰**ï¼š
  è¡¨ç¤ºå½“å‰è¾“å…¥å›¾åƒåœ¨å¤šä¸ªè¾“å‡ºç‰¹å¾å±‚ä¸Šæ€»å…±ç”Ÿæˆäº† 8400 ä¸ªå€™é€‰æ¡†ã€‚æ¯”å¦‚è¾“å…¥å°ºå¯¸æ˜¯ 640x640ï¼Œç»è¿‡ FPN åçš„ 3 ä¸ªç‰¹å¾å±‚ï¼ˆ80x80ã€40x40ã€20x20ï¼‰æ¯ä¸ªç‚¹ä½é¢„æµ‹ä¸€ä¸ªæ¡†ï¼Œå…±ï¼š

  ```
  80Ã—80 + 40Ã—40 + 20Ã—20 = 6400 + 1600 + 400 = 8400
  ```

---

### ğŸ¯ æ€»ç»“ä¸€å¥è¯ï¼š

> `[1, 5, 8400]` ä¸­çš„ `1` è¡¨ç¤º **è¿™ç»„é¢„æµ‹æ˜¯é’ˆå¯¹ 1 å¼ å›¾åƒçš„**ï¼Œ`5` è¡¨ç¤ºæ¯ä¸ªæ¡† 5 ä¸ªåŸºç¡€å±æ€§ï¼Œ`8400` æ˜¯é¢„æµ‹æ¡†æ€»æ•°é‡ã€‚

---

å¦‚æœä½ æ¥ä¸‹æ¥è¦å¤„ç†çš„è¾“å‡ºè¿˜ä¼šåŒ…å«åˆ†ç±»åˆ†æ•°ï¼Œé‚£å½¢çŠ¶ä¼šå˜ä¸º `[1, 5 + num_classes, 8400]`ï¼Œä¾‹å¦‚ `[1, 85, 8400]` ç”¨äº COCOï¼ˆ80 ç±»ï¼‰ã€‚å¦‚æœä½ ä¸ç¡®å®šæ¨¡å‹æ˜¯å¸¦ç±»ä¿¡æ¯çš„ï¼Œæˆ‘å¯ä»¥æ•™ä½ å¦‚ä½•æ‰“å°å‡ºå®é™…çš„è¾“å‡ºå€¼å’Œç»“æ„æ¥åˆ¤æ–­ã€‚æ˜¯å¦éœ€è¦ï¼Ÿ

## å¼•ç”¨

+ https://blog.csdn.net/qq_42589613/article/details/140040501
+ https://blog.csdn.net/Yaoyao2024/article/details/136429078
+ https://blog.csdn.net/qq_40672115/article/details/143089165
+ https://blog.csdn.net/qq_48626006/article/details/140174669