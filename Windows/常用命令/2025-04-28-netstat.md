---
title: netstat
tag:
  - WinCMD
categories:
  - Windows
date: 2025-04-28 09:00:00 +0800
layout: post
---
## 摘要

+ netstat 命令 相关学习笔记
  
<!--more-->

## windows netstat命令 是什么

Windows 的 `netstat` 命令（Network Statistics）是一个用于**显示网络连接、路由表、接口统计等网络相关信息的命令行工具**。它可以帮助用户诊断网络问题、监控连接状态、查看端口占用情况等，是网络管理和故障排查的常用工具。

---

### **主要功能**
1. **显示活动的 TCP/UDP 连接**  
   - 本地和远程的 IP 地址及端口号。
   - 连接状态（如 `ESTABLISHED`、`LISTENING`、`CLOSE_WAIT` 等）。

2. **查看监听端口**  
   - 列出当前系统正在监听的端口及对应的程序。

3. **显示网络接口统计信息**  
   - 数据包发送/接收量、错误计数等。

4. **路由表信息**  
   - 显示本地路由表，用于了解数据包如何被转发。

---

### **常用参数**
| 参数 | 说明 |
|------|------|
| `-a`  | 显示所有连接和监听端口（包括 TCP 和 UDP）。 |
| `-n`  | 以数字形式显示地址和端口号（不解析主机名或服务名）。 |
| `-b`  | 显示创建连接的**可执行文件名称**（需管理员权限）。 |
| `-o`  | 显示与连接关联的**进程 ID (PID)**。 |
| `-p <协议>` | 指定协议类型（如 `TCP`、`UDP`）。 |
| `-r`  | 显示**路由表**（等同于 `route print`）。 |
| `-e`  | 显示以太网统计信息（如发送/接收的字节数）。 |
| `-s`  | 按协议（TCP/UDP/IP）显示统计信息。 |
| `-t <秒>` | 自动刷新显示（如 `netstat -n 5` 每 5 秒刷新一次）。 |

---

### **使用示例**
1. **查看所有活动连接及监听端口（含 PID）**  
   ```bash
   netstat -ano
   ```
   - `-a`：显示所有连接和监听端口。
   - `-n`：以数字形式显示地址和端口。
   - `-o`：显示进程 PID。

2. **查找占用特定端口的进程（如 80 端口）**  
   ```bash
   netstat -ano | findstr ":80"
   ```
   - 结合 `findstr` 过滤结果，再通过 PID 在任务管理器（详细信息标签页）中定位程序。

3. **查看由特定程序创建的连接（如 Chrome）**  
   ```bash
   netstat -ab | findstr "chrome.exe"
   ```
   - `-b`：显示可执行文件名（需管理员权限运行命令提示符）。

4. **实时监控网络连接（每 3 秒刷新）**  
   ```bash
   netstat -n 3
   ```

5. **显示路由表**  
   ```bash
   netstat -r
   ```

---

### **常见应用场景**
1. **排查端口冲突**  
   当程序无法启动（如 Web 服务器提示“端口被占用”），用 `netstat -ano` 找到占用端口的 PID，结束对应进程。

2. **检测异常连接**  
   检查是否有未知程序建立外部连接（可能为恶意软件）。

3. **监控网络流量**  
   通过 `-e` 参数查看接口的数据包统计，分析网络负载。

4. **路由问题诊断**  
   使用 `-r` 查看路由表，确认网关和路径是否正确。

---

### **注意事项**
- **管理员权限**：部分参数（如 `-b`）需要以管理员身份运行命令提示符。
- **结合其他工具**：  
  - 用 `tasklist | findstr "PID"` 将 PID 映射到进程名。  
  - 使用 `telnet` 或 `Test-NetConnection`（PowerShell）测试端口可达性。

掌握 `netstat` 能帮助你更高效地管理网络连接，快速定位问题根源。

## windows 根据程序名查看监听的端口

在 Windows 中，可以通过 `netstat` 命令结合程序名查看其监听的端口。以下是具体步骤：

---

### **方法 1：使用 `netstat -abn` + 程序名过滤**
1. **以管理员身份打开命令提示符（CMD）或 PowerShell**  
   - 右键点击“开始菜单” → 选择“终端（管理员）”或“命令提示符（管理员）”。

2. **运行以下命令，显示所有监听端口及对应的程序名**  
   ```bash
   netstat -abn
   ```
   - **参数说明**：
     - `-a`：显示所有连接和监听端口。
     - `-b`：显示创建连接/监听端口的**程序名**（需管理员权限）。
     - `-n`：以数字形式显示 IP 和端口（不解析为域名或服务名）。

3. **过滤特定程序名（如 `chrome.exe`）**  
   ```bash
   netstat -abn | findstr "程序名"
   ```
   示例：查找 `chrome.exe` 监听的端口：
   ```bash
   netstat -abn | findstr "chrome.exe"
   ```

   **输出示例**：
   ```
   TCP    0.0.0.0:8080           0.0.0.0:0              LISTENING       1234
   [chrome.exe]
   ```
   - `0.0.0.0:8080` 表示程序在 `8080` 端口监听所有网络接口。
   - `LISTENING` 表示该端口处于监听状态。

---

### **方法 2：结合 `netstat -ano` + 任务管理器（无需管理员权限）**
1. **运行命令，显示所有连接及进程 PID**  
   ```bash
   netstat -ano
   ```

2. **查找目标端口的 PID**  
   通过 `findstr` 过滤监听状态（`LISTENING`）的端口：
   ```bash
   netstat -ano | findstr "LISTENING"
   ```

3. **根据 PID 查找程序名**  
   记录目标端口的 PID（例如 `1234`），然后打开任务管理器：  
   - 进入“详细信息”标签页 → 右键点击列标题 → 勾选“PID”。  
   - 根据 PID 找到对应的程序名。

---

### **方法 3：使用 PowerShell（更高效）**
在 PowerShell 中，可以通过以下命令直接关联程序名和端口：
```powershell
Get-Process -Id (Get-NetTCPConnection -State Listen | Select-Object OwningProcess).OwningProcess | Format-Table Id, ProcessName, @{Name="LocalPort"; Expression={ ($_.Id | Get-NetTCPConnection -State Listen).LocalPort }}
```
- 该命令会列出所有监听端口的进程 ID、程序名及端口号。

---

### **常见问题**
1. **权限不足**  
   - 如果使用 `-b` 参数时未以管理员身份运行，会提示 `拒绝访问`。务必使用管理员权限。

2. **程序名未显示**  
   - 部分系统服务或内核级进程可能不会显示程序名，需通过 PID 在任务管理器中确认。

3. **端口被多个进程占用**  
   - 某些程序可能通过子进程监听端口，需结合 PID 和程序树分析。

---

### **示例场景**
假设你想查看 `nginx.exe` 监听的端口：
```bash
netstat -abn | findstr "nginx.exe"
```
输出：
```
TCP    0.0.0.0:80             0.0.0.0:0              LISTENING       5678
[nginx.exe]
```
- `80` 端口被 `nginx.exe` 监听，进程 PID 为 `5678`。

---

通过上述方法，你可以快速定位程序监听的端口，解决端口冲突或排查异常网络行为。